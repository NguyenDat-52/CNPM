@model IEnumerable<QuanLyKhachSan.Models.DAT_PHONG>
@{
    ViewBag.Title = "Quản Lý Đặt Phòng";
}

<div class="container py-4">
    <h2 class="mb-4">Quản Lý Đặt Phòng</h2>
    
    @if(TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }

    <div class="card shadow">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light sticky-top">
                    <tr>
                        <th>#</th>
                        <th>Khách Hàng</th>
                        <th>Phòng</th>
                        <th>Ngày Nhận</th>
                        <th>Ngày Trả</th>
                        <th>Trạng Thái</th>
                        <th>Thao Tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.MA_DP</td>
                            <td>
                                <div>@item.KHACH_HANG.HO_TEN</div>
                                <small class="text-muted">@item.KHACH_HANG.SDT</small>
                            </td>
                            <td>@item.PHONG.TEN_PHONG</td>
                            <td>@((item.NGAY_NHAN ?? DateTime.MinValue).ToString("dd/MM/yyyy"))</td>
                            <td>@((item.NGAY_TRA ?? DateTime.MinValue).ToString("dd/MM/yyyy"))</td>
                            <td>
                                @if(item.TRANG_THAI == "DA_NHAN") { <span class="badge bg-primary">ĐANG Ở</span> }
                                else if(item.TRANG_THAI == "DA_DAT") { <span class="badge bg-info text-dark">ĐÃ ĐẶT</span> }
                                else if(item.TRANG_THAI == "HOAN_THANH") { <span class="badge bg-success">HOÀN THÀNH</span> }
                                else { <span class="badge bg-secondary">@item.TRANG_THAI</span> }
                            </td>
                            <td>
                                <div class="btn-group">
                                    @if(item.TRANG_THAI == "DA_DAT") // Can Check In
                                    {
                                         using(Html.BeginForm("CheckIn", "Staff", new { id = item.MA_DP }, FormMethod.Post)) {
                                             <button class="btn btn-sm btn-primary">Check-in</button>
                                         }
                                    }
                                    
                                    @if(item.TRANG_THAI == "DA_NHAN") // Can Add Service or Check Out
                                    {
                                        <a href="@Url.Action("AddService", new { id = item.MA_DP })" class="btn btn-sm btn-outline-success">Dịch Vụ</a>
                                        using(Html.BeginForm("CheckOut", "Staff", new { id = item.MA_DP }, FormMethod.Post)) {
                                             <button class="btn btn-sm btn-warning ms-1" onclick="return confirm('Xác nhận thanh toán và trả phòng?');">Check-out</button>
                                         }
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
